# SCGI configuration
worker_processes auto;

events {
    worker_connections 1024;
}

http {
    include /etc/nginx/mime.types;
    default_type application/octet-stream;

    upstream scgi_backend {
        server 127.0.0.1:4000;
        server 127.0.0.1:4001;
    }

    server {
        listen 80;
        listen [::]:80;
        server_name scgi.example.com;
        root /var/www/html;

        location / {
            scgi_pass scgi_backend;
            scgi_param REQUEST_METHOD $request_method;
            scgi_param REQUEST_URI $request_uri;
            scgi_param QUERY_STRING $query_string;
            scgi_param CONTENT_TYPE $content_type;
            scgi_param CONTENT_LENGTH $content_length;
            scgi_param DOCUMENT_URI $document_uri;
            scgi_param DOCUMENT_ROOT $document_root;
            scgi_param SCGI 1;
            scgi_param SERVER_PROTOCOL $server_protocol;
            scgi_param SERVER_SOFTWARE nginx/$nginx_version;
            scgi_param REMOTE_ADDR $remote_addr;
            scgi_param REMOTE_PORT $remote_port;
            scgi_param SERVER_ADDR $server_addr;
            scgi_param SERVER_PORT $server_port;
            scgi_param SERVER_NAME $server_name;

            scgi_read_timeout 60s;
            scgi_send_timeout 60s;
            scgi_connect_timeout 10s;
            scgi_buffer_size 4k;
            scgi_buffers 8 4k;
        }

        location /static/ {
            alias /var/www/static/;
            expires 1y;
            add_header Cache-Control "public, immutable";
        }
    }
}
