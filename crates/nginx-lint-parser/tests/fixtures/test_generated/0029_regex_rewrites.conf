# Regex in rewrite rules
worker_processes auto;

events {
    worker_connections 1024;
}

http {
    server {
        listen 80;
        server_name regex.example.com;

        # Simple rewrite
        rewrite ^/old-page$ /new-page permanent;

        # Rewrite with capture
        rewrite ^/blog/([0-9]{4})/([0-9]{2})/(.*)$ /posts/$1-$2-$3 redirect;

        # Rewrite with optional segment
        rewrite ^/products(/.*)?$ /shop$1 last;

        # Rewrite removing extension
        rewrite ^/page/(.*)\.html$ /page/$1 permanent;

        # Complex rewrite pattern
        rewrite ^/user/([a-z]+)/album/([0-9]+)/photo/([0-9]+)$ /media?user=$1&album=$2&photo=$3 last;

        location / {
            root /var/www/html;
        }

        location /posts {
            proxy_pass http://127.0.0.1:8080;
        }

        location /shop {
            proxy_pass http://127.0.0.1:8081;
        }

        location /media {
            proxy_pass http://127.0.0.1:8082;
        }
    }
}
