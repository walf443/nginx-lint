http {
  # Solution 1: upstream with 'resolve' and 'zone' (nginx 1.27.3+ or nginx Plus)
  upstream backend {
    zone backend_zone 64k;
    server api.example.com:80 resolve;
  }
  server {
    location / {
      proxy_pass http://backend;
    }
  }

  # Solution 2: Use 'set' with 'resolver' for older nginx versions
  # The variable forces DNS re-resolution on each request
  resolver 8.8.8.8 valid=30s;
  server {
    listen 8080;
    set $backend_host "api.example.com";
    location / {
      proxy_pass http://$backend_host:80;
    }
  }
}
