# Regex grouping patterns
worker_processes auto;

events {
    worker_connections 1024;
}

http {
    server {
        listen 80;
        server_name regex.example.com;

        # Capture group for rewrite
        location ~ ^/old/(.*)$ {
            rewrite ^/old/(.*)$ /new/$1 permanent;
        }

        # Multiple capture groups
        location ~ ^/user/([0-9]+)/post/([0-9]+)$ {
            set $user_id $1;
            set $post_id $2;
            proxy_pass http://127.0.0.1:8080;
        }

        # Non-capturing group
        location ~ ^/(?:api|rest)/users {
            proxy_pass http://127.0.0.1:8080;
        }

        # Optional group
        location ~ ^/products(/category/[a-z]+)?$ {
            proxy_pass http://127.0.0.1:8080;
        }

        # Repeated group
        location ~ ^(/[a-z]+)+/index\.html$ {
            root /var/www;
        }
    }
}
